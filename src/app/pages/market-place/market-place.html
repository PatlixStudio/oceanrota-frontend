<div class="marketplace-container">

  <!-- Intro / Hero -->
  <section class="intro">
    <h1 i18n="@@marketplaceTitle">⚓ Boat Marketplace</h1>
    <p class="subtitle" i18n="@@marketplaceDesc">
      Explore a global marketplace for buying and selling vessels of all kinds — from fishing boats to luxury
      yachts.
      Connect with trusted sellers and buyers worldwide, and make your next maritime deal with confidence.
    </p>
    <button mat-raised-button color="primary" [routerLink]="['/tokenize']">
      <span i18n="@@marketplaceTokenizeBtn">Tokenize Your Vessel</span>
    </button>
  </section>

  <!-- Marketplace Grid -->
  <section class="marketplace-grid">

    <section class="boat-filter">
      <app-boat-filter (filterChanged)="onFilterChanged($event)"></app-boat-filter>
    </section>

    <section class="boat-listings">
      <!-- Sort & Summary Bar -->
      <section class="sort-listing">
        <div class="listing-count">
          Total Listings: <strong>{{ totalListings() }}</strong>
        </div>

        <div class="sort-controls">
          <button matIconButton (click)="setViewMode('list')">
            <mat-icon>list_view</mat-icon>
          </button>
          <button matIconButton (click)="setViewMode('grid')">
            <mat-icon>grid_view</mat-icon>
          </button>
          <mat-form-field appearance="outline" class="sort-field" subscriptSizing="dynamic">
            <mat-label>Sort by</mat-label>
            <mat-select [(ngModel)]="sortOption" (selectionChange)="sortListings()">
              <mat-option value="Recommended">Recommended</mat-option>
              <mat-option value="newest">Listing Date: Newest First</mat-option>
              <mat-option value="oldest">Listing Date: Oldest First</mat-option>
              <mat-option value="priceHigh">Price: High to Low</mat-option>
              <mat-option value="priceLow">Price: Low to High</mat-option>
              <mat-option value="yearNew">Year: Newest</mat-option>
              <mat-option value="yearOld">Year: Oldest</mat-option>
              <mat-option value="lengthLong">Length: Longest First</mat-option>
              <mat-option value="lengthShort">Length: Shortest First</mat-option>
              <mat-option value="makeAsc">Make: A to Z</mat-option>
              <mat-option value="makeDsc">Make: Z to A</mat-option>
              <mat-option value="ditanceAsc">Distance: Nearest First</mat-option>
              <mat-option value="distanceDsc">Distance: Farthest First</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </section>


      <section class="cards-grid" [ngClass]="viewMode">
        <mat-card class="vessel-card" *ngFor="let listing of listings()">
          <img mat-card-image [src]="listing.vessel?.images?.[0] || './assets/images/marine_icons/boat.png'"
            [alt]="listing.title || 'Boat image'" />

          <div class="details-column">
            <mat-card-header>
              <mat-card-title>
                <span [routerLink]="['/marketplace/boats', listing.id]" class="title-link">{{ listing.title }}</span>
              </mat-card-title>
              <mat-card-subtitle class="vessel-price">{{ listing.price | currency}} {{ listing.currency
                }}</mat-card-subtitle>
              <mat-card-subtitle>{{ listing.vessel?.boatClass }} • {{ listing.vessel?.port }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p>{{ listing.description }}</p>

              <div class="owner">
                <div class="owner-details">
                  <img class="owner-avatar"
                    [src]="listing.owner?.avatarUrl || './assets/images/marine_icons/sailor.png'">
                  <strong>@{{ listing.owner?.username }}</strong>
                </div>
                <button mat-raised-button>Follow</button>
              </div>
            </mat-card-content>
          </div>
        </mat-card>
      </section>

      <ng-template #loadingTpl>
        <p class="text-center p-4">Loading listings...</p>
      </ng-template>

      <section class="listing-paginator">
        <mat-paginator #paginator class="demo-paginator" (page)="handlePageEvent($event)" [length]="totalListings()"
          [pageSize]="pageSize" [disabled]="disabled" [showFirstLastButtons]="showFirstLastButtons"
          [pageSizeOptions]="showPageSizeOptions ? pageSizeOptions : []" [hidePageSize]="hidePageSize"
          [pageIndex]="pageIndex" aria-label="Select page">
        </mat-paginator>
      </section>

    </section>
  </section>
</div>