@if ( boat(); as listing) {
<div class="boat-details-grid">

  <!-- LEFT SIDE -->
  <div class="boat-left">
    <mat-card>
      <gallery [items]="galleryItems" thumbs thumbPosition="bottom" imageSize="cover" loadingStrategy="lazy" lightbox></gallery>

      <mat-card-header>
        <div class="boat-header">
          <h1 class="boat-title">{{ listing.title }}</h1>
          <h3 class="boat-subtitle">
            {{ listing.vessel?.make }} • {{ listing.vessel?.vesselType }} • {{ listing.vessel?.year }}
          </h3>
          <p class="boat-description">{{ listing.description }}</p>
        </div>
      </mat-card-header>

      <mat-card-content>
        <mat-accordion multi="true" class="details-accordion">
          <mat-expansion-panel>
            <mat-expansion-panel-header opened>
              <mat-panel-title>Vessel Information</mat-panel-title>
            </mat-expansion-panel-header>
            <div class="info-grid">
              <p><strong>Category:</strong> {{ listing.vessel?.category}}</p>
              <p><strong>Class:</strong> {{ listing.vessel?.vesselClass }}</p>
              <p><strong>Type:</strong> {{ listing.vessel?.vesselType }}</p>
              <p><strong>Length:</strong> {{ listing.vessel?.length_m }} m</p>
              <p><strong>Beam:</strong> {{ listing.vessel?.beam_m }} m</p>
              <p><strong>Condition:</strong> {{ listing.vessel?.condition }}</p>
              <p><strong>Hull Material:</strong> {{ listing.vessel?.hullMaterial }}</p>
              <p><strong>Capacity:</strong> {{ listing.vessel?.capacity }}</p>
              <p><strong>Year:</strong> {{ listing.vessel?.year }}</p>
            </div>
          </mat-expansion-panel>

          @if (listing.vessel?.features) {
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>Features</mat-panel-title>
            </mat-expansion-panel-header>
            <ul>
              <li *ngFor="let feat of listing.vessel?.features | keyvalue">
                <strong>{{ feat.key }}:</strong> {{ feat.value }}
              </li>
            </ul>
          </mat-expansion-panel>
          }

          @if (listing.vessel?.engines?.length) {
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>Engine Details</mat-panel-title>
            </mat-expansion-panel-header>
            <div *ngFor="let engine of listing.vessel?.engines" class="engine-item">
              <p><strong>Brand:</strong> {{ engine.brand }}</p>
              <p><strong>Model:</strong> {{ engine.model }}</p>
              <p><strong>Power:</strong> {{ engine.horsepower}} HP</p>
              <p><strong>Fuel:</strong> {{ engine.fuelType }}</p>
            </div>
          </mat-expansion-panel>
          }
        </mat-accordion>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- RIGHT SIDE -->
  <div class="boat-right">
    <mat-card class="summary-card">
      <mat-card-content>
        <h2 class="price">Sale: {{ listing?.salePrice | number:'1.0-0' }} {{ listing.currency }}</h2>
        <p><mat-icon>place</mat-icon> {{ listing.vessel?.address?.city }}, {{ listing.vessel?.address?.country }}</p>
        <p><strong>Port:</strong> {{ listing.vessel?.address?.country }}</p>
        <button mat-flat-button color="primary">Contact Owner</button>
        <button mat-stroked-button color="accent">Add to Favorites</button>
      </mat-card-content>
    </mat-card>

    <mat-card class="owner-card">
      <mat-card-header>
        <img *ngIf="listing.owner?.avatarUrl" mat-card-avatar [src]="listing.owner?.avatarUrl" alt="Owner Avatar">
        <mat-card-title>{{ listing.owner?.username }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p *ngIf="listing.owner?.fullName">{{ listing.owner?.fullName }}</p>
        <p><strong>Member since:</strong> {{ listing.owner?.createdAt | date }}</p>
      </mat-card-content>
    </mat-card>
  </div>

</div>
} @else {
<div class="loading">
  <mat-spinner></mat-spinner>
  <p>Loading vessel details...</p>
</div>
}