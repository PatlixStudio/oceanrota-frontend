<div class="add-listing-container">
  <mat-card class="add-listing-card">

    <mat-card-header class="add-listing-card-header">
      <mat-card-title i18n="@@addListing.title">Add New Vessel Listing</mat-card-title>
      <mat-card-subtitle>Create a new listing !</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="addListingForm" (ngSubmit)="createListing()" novalidate>
        <div class="form-grid">
          <h3 i18n="@@addListing.section.listing.title">General Listing Information</h3>

          <!-- Listing Info -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label i18n="@@addListing.field.title.label">Title</mat-label>
            <input matInput formControlName="title" placeholder="Sea Ray 40 Motor Yacht">
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label i18n="@@addListing.field.description.label">Description</mat-label>
            <textarea matInput rows="4" formControlName="description"
              placeholder="Describe the vessel, features, and condition"></textarea>
          </mat-form-field>

          <!-- Images -->
          <div class="image-upload full-width">
            <label for="images" i18n="@@addListing.field.images.label"><strong>Upload Images</strong></label>
            <!-- Placeholder when no images selected -->
            <div class="placeholder" *ngIf="!previewImages.length">
              <img src="assets/images/marine_icons/anchor.png" alt="Placeholder" class="placeholder-img">
              <p>Select images to preview here</p>
            </div>

            <!-- Preview Grid -->
            <div class="image-preview-grid" *ngIf="previewImages.length">
              <div class="preview-item" *ngFor="let img of previewImages; let i = index"
                [class.featured]="featuredImage === img">

                <img [src]="img" alt="Preview">

                <!-- Featured Button -->
                <button mat-raised-button color="primary" type="button" class="featured-btn" (click)="setFeatured(img)">
                  {{ featuredImage === img ? 'Featured' : 'Set as Featured' }}
                </button>
              </div>
            </div>

            <button mat-raised-button color="primary" type="button" (click)="fileInput.click()">
              Select Images
            </button>

            <input #fileInput type="file" hidden multiple accept="image/*" (change)="onImageSelected($event)" />
          </div>

          <mat-label i18n="@@addListing.field.listingPurpose.label"><strong>Listing Purpose</strong></mat-label>
          <mat-button-toggle-group formControlName="listingPurpose" name="listing_purpose" aria-label="Listing Purpose"
            class="listingTypeBtnGrp">
            @for (item of listingPurpose; track $index) {
            <mat-button-toggle [value]="item">{{item}}</mat-button-toggle>
            }
          </mat-button-toggle-group>

          <mat-form-field appearance="outline" *ngIf="isSale()">
            <mat-label i18n="@@addListing.field.price.label">Sale Price</mat-label>
            <input matInput type="number" formControlName="salePrice" placeholder="100000">
          </mat-form-field>

          <mat-form-field appearance="outline" *ngIf="isSale()">
            <mat-label i18n="@@addListing.field.currency.label">Currency</mat-label>
            <mat-select formControlName="currency">
              <mat-option *ngFor="let c of currencies" [value]="c">{{ c }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" *ngIf="isRent()">
            <mat-label i18n="@@addListing.field.price.label">Rent Price</mat-label>
            <input matInput type="number" formControlName="rentPrice" placeholder="100000">
          </mat-form-field>

          <mat-form-field appearance="outline" *ngIf="isRent()">
            <mat-label i18n="@@addListing.field.currency.label">Currency</mat-label>
            <mat-select formControlName="currency">
              <mat-option *ngFor="let c of currencies" [value]="c">{{ c }}</mat-option>
            </mat-select>
          </mat-form-field>

          <section class="visibility-section full-width">
            <h3 class="section-title" i18n="@@addListing.section.visibility.title">
              Listing Visibility
            </h3>

            <mat-radio-group formControlName="visibilityType" class="visibility-group">

              <!-- STANDARD -->
              <mat-radio-button value="STANDARD" class="visibility-option">
                <div class="option-content standard">
                  <strong i18n="@@addListing.visibility.standard.title">
                    Standard Listing
                  </strong>
                  <p i18n="@@addListing.visibility.standard.desc">
                    Visible in search results with standard placement.
                  </p>
                  <span class="price">Free</span>
                </div>
              </mat-radio-button>

              <!-- FEATURED -->
              <mat-radio-button value="FEATURED" class="visibility-option">
                <div class="option-content featured">
                  <strong i18n="@@addListing.visibility.featured.title">
                    ★ Featured Listing
                  </strong>
                  <p i18n="@@addListing.visibility.featured.desc">
                    Highlighted placement, homepage exposure, faster sales.
                  </p>
                </div>
              </mat-radio-button>

            </mat-radio-group>


            <div class="featured-plans" *ngIf="addListingForm.get('visibilityType')?.value === 'FEATURED'">

              <h4 i18n="@@addListing.featuredPlans.title">
                Choose Featured Duration
              </h4>

              <mat-radio-group formControlName="featuredPlan" class="featured-plan-group">
                <!-- 7 DAYS -->
                <mat-card class="featured-plan-card">
                  <mat-radio-button [value]="featuredPlans.FEATURED_30" class="plan-radio">
                    <div class="plan-content">
                      <h3>30 Days</h3>
                      <p>Boost visibility for a short period</p>
                      <span class="price">€15</span>
                    </div>
                  </mat-radio-button>
                </mat-card>

                <!-- 14 DAYS -->
                <mat-card class="featured-plan-card recommended">
                  <mat-radio-button [value]="featuredPlans.FEATURED_60" class="">
                    <div class="plan-content plan-radio">
                      <h3>60 Days</h3>
                      <p>Best balance of exposure & value</p>
                      <span class="price">€29</span>
                      <span class="badge">Most Popular</span>
                    </div>
                  </mat-radio-button>
                </mat-card>

                <!-- 30 DAYS -->
                <mat-card class="featured-plan-card premium">
                  <mat-radio-button [value]="featuredPlans.FEATURED_90" class="plan-radio">
                    <div class="plan-content">
                      <h3>90 Days</h3>
                      <p>Maximum exposure & priority placement</p>
                      <span class="price">€49</span>
                    </div>
                  </mat-radio-button>
                </mat-card>
              </mat-radio-group>
            </div>
          </section>


          <!-- Vessel Info -->
          <h3 i18n="@@addListing.section.vessel.title">Vessel Information</h3>
          <div [formGroup]="vesselForm" class="full-width vessel-section">

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.category.label">Category</mat-label>
              <mat-select formControlName="category">
                @for (category of categories; track category) {
                <mat-option [value]="category">{{category}}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.vesselName.label">Vessel Name</mat-label>
              <input matInput formControlName="vesselName" placeholder="Sea Ray 40">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.make.label">Make</mat-label>
              <input matInput formControlName="make" placeholder="Beneteau, Sea Ray, etc.">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.model.label">Model</mat-label>
              <input matInput formControlName="model" placeholder="47 Power, Oceanis, etc.">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.year.label">Year</mat-label>
              <input matInput type="number" formControlName="year" placeholder="2022">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.vesselType.label">Vessel Type</mat-label>
              <mat-select formControlName="vesselType">
                <mat-option *ngFor="let type of vesselTypes" [value]="type">{{ type }}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.boatClass.label">Vessel Class</mat-label>
              <input matInput formControlName="vesselClass" placeholder="Cruiser, Motor Yacht, etc.">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.boatClass.label">Registry Number</mat-label>
              <input matInput formControlName="registryNumber" placeholder="CF 1234 AB">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.boatClass.label">IMO Number</mat-label>
              <input matInput formControlName="imoNumber" placeholder="IMO 1234567">
            </mat-form-field>

            <div class="dimensions-section">
              <h3 i18n="@@addListing.section.engine.title" class="section-title">Dimensions & Specs</h3>
              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.hullMaterial.label">Hull Material</mat-label>
                <mat-select formControlName="hullMaterial">
                  <mat-option value="Wood">Wood</mat-option>
                  <mat-option value="Fiberglass">Fiberglass</mat-option>
                  <mat-option value="Aluminum">Aluminum</mat-option>
                  <mat-option value="Steel">Steel</mat-option>
                  <mat-option value="Composite">Composite</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.length.label">Length (m)</mat-label>
                <input matInput type="number" formControlName="length_m" placeholder="14.5">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.length.label">Weight (kg)</mat-label>
                <input matInput type="number" formControlName="weight_kg" placeholder="14.5">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.beam.label">Beam (m)</mat-label>
                <input matInput type="number" formControlName="beam_m" placeholder="4.5">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.draft.label">Draft (m)</mat-label>
                <input matInput type="number" formControlName="draft_m" placeholder="1.2">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.condition.label">Condition</mat-label>
                <mat-select formControlName="condition">
                  <mat-option *ngFor="let c of conditions" [value]="c">{{ c }}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.capacity.label">Capacity</mat-label>
                <input matInput type="number" formControlName="capacity" placeholder="8">
              </mat-form-field>
            </div>

            <div class="accomodation-section">
              <h3 i18n="@@addListing.section.engine.title" class="section-title">Accomodation</h3>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.capacity.label">Guest Cabins</mat-label>
                <input matInput type="number" formControlName="guestCabins" placeholder="2">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.capacity.label">Guest Heads</mat-label>
                <input matInput type="number" formControlName="guestHeads" placeholder="1">
              </mat-form-field>
            </div>

            <div class="tanks-section">
              <h3 i18n="@@addListing.section.engine.title" class="section-title">Tanks</h3>
              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.capacity.label">Fuel Tank (lt)</mat-label>
                <input matInput type="number" formControlName="fuelTank_liter" placeholder="8">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.capacity.label">Water Tank (lt)</mat-label>
                <input matInput type="number" formControlName="waterTank_liter" placeholder="8">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.capacity.label">Holding Tank (lt)</mat-label>
                <input matInput type="number" formControlName="holdingTank_liter" placeholder="8">
              </mat-form-field>
            </div>

            <!-- Engines -->
            <div formArrayName="engines" class="full-width engine-section">
              <h3 i18n="@@addListing.section.engine.title">Engines</h3>

              <div *ngFor="let engine of engines.controls; let i = index" [formGroupName]="i" class="engine-item">
                <mat-form-field appearance="outline">
                  <mat-label i18n="@@addListing.field.engine.make.label">Brand</mat-label>
                  <input matInput formControlName="brand" placeholder="Volvo Penta">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label i18n="@@addListing.field.engine.make.label">Model</mat-label>
                  <input matInput formControlName="model" placeholder="Volvo Penta">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label i18n="@@addListing.field.engine.power.label">Power (hp)</mat-label>
                  <input matInput type="number" formControlName="horsepower" placeholder="300">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Drive Type</mat-label>
                  <mat-select formControlName="driveType">
                    @for (drive of driveTypes; track drive) {
                    <mat-option [value]="drive">{{ drive }}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label i18n="@@addListing.field.engine.hours.label">Engine Hours</mat-label>
                  <input matInput type="number" formControlName="hours" placeholder="1200">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Fuel Type</mat-label>
                  <mat-select formControlName="fuelType">
                    @for (fuel of fuelTypes; track fuel) {
                    <mat-option [value]="fuel">{{fuel}}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>

                <button mat-button color="warn" type="button" (click)="removeEngine(i)"
                  i18n="@@addListing.field.engine.remove">Remove</button>
              </div>

              <button mat-stroked-button color="primary" type="button" (click)="addEngine()"
                i18n="@@addListing.field.engine.add">Add Engine</button>
            </div>

            <!-- Location -->
            <div class="vessel-location" [formGroup]="addressFormGroup">
              <h3 class="section-title" i18n="@@addListing.section.vessel.title">
                Vessel Location
              </h3>

              <!-- Address line 1 -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Address</mat-label>
                <textarea matInput rows="1" placeholder="Ex. 100 Main St" formControlName="address_1"></textarea>
              </mat-form-field>

              <!-- Address line 2 -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Address 2</mat-label>
                <textarea matInput rows="1" formControlName="address_2"></textarea>
              </mat-form-field>

              <!-- Country -->
              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.country.label">Country</mat-label>
                <input matInput formControlName="country" placeholder="Turkey">
              </mat-form-field>

              <!-- City -->
              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.city.label">City</mat-label>
                <input matInput formControlName="city" placeholder="Istanbul">
              </mat-form-field>

              <!-- State -->
              <mat-form-field appearance="outline">
                <mat-label>State</mat-label>
                <input matInput placeholder="Ex. California" formControlName="state">
              </mat-form-field>

              <!-- Port -->
              <mat-form-field appearance="outline">
                <mat-label i18n="@@addListing.field.port.label">Port</mat-label>
                <input matInput formControlName="port" placeholder="Kalamis Marina">
              </mat-form-field>

              <!-- Postal code -->
              <mat-form-field appearance="outline">
                <mat-label>Postal Code</mat-label>
                <input matInput maxlength="10" placeholder="Ex. 94105" formControlName="postal_code">
              </mat-form-field>
            </div>

          </div>
        </div>

        <!-- Actions -->
        <div class="actions">
          <button mat-stroked-button color="warn" type="reset" i18n="@@addListing.button.reset">Reset</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading"
            i18n="@@addListing.button.submit">Create Listing</button>
        </div>

      </form>

    </mat-card-content>
  </mat-card>
</div>