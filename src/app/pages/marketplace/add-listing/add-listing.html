<div class="add-listing-container">
  <mat-card class="add-listing-card">

    <mat-card-header class="add-listing-card-header">
      <mat-card-title i18n="@@addListing.title">Add New Boat Listing</mat-card-title>
      <mat-card-subtitle>@Create a new listing !</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>

      <form [formGroup]="addListingForm" (ngSubmit)="createListing()" novalidate>
        <div class="form-grid">
          <h3 i18n="@@addListing.section.listing.title">General Listing Information</h3>

          <!-- Listing Info -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label i18n="@@addListing.field.title.label">Title</mat-label>
            <input matInput formControlName="title" placeholder="Sea Ray 40 Motor Yacht">
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label i18n="@@addListing.field.description.label">Description</mat-label>
            <textarea matInput rows="4" formControlName="description"
              placeholder="Describe the vessel, features, and condition"></textarea>
          </mat-form-field>

          <!-- Images -->
          <div class="image-upload full-width">

            <label for="images" i18n="@@addListing.field.images.label">Upload Images</label>

            <button mat-raised-button color="primary" type="button" (click)="fileInput.click()">
              Select Images
            </button>

            <input #fileInput type="file" hidden multiple accept="image/*" (change)="onImageSelected($event)" />

            <!-- Placeholder when no images selected -->
            <div class="placeholder" *ngIf="!previewImages.length">
              <img src="assets/images/marine_icons/anchor.png" alt="Placeholder" class="placeholder-img">
              <p>Select images to preview here</p>
            </div>

            <!-- Preview Grid -->
            <div class="image-preview-grid" *ngIf="previewImages.length">
              <div class="preview-item" *ngFor="let img of previewImages; let i = index"
                [class.featured]="featuredImage === img">

                <img [src]="img" alt="Preview">

                <!-- Featured Button -->
                <button mat-stroked-button color="accent" type="button" class="featured-btn" (click)="setFeatured(img)">
                  {{ featuredImage === img ? 'Featured' : 'Set as Featured' }}
                </button>
              </div>
            </div>

          </div>

          <mat-label i18n="@@addListing.field.listingType.label">Listing Type</mat-label>
          <mat-button-toggle-group formControlName="listingType" name="listing_type" aria-label="Listing Type"
            class="listingTypeBtnGrp">
            @for (item of listingTypes; track $index) {
            <mat-button-toggle [value]="item">{{item}}</mat-button-toggle>
            }
          </mat-button-toggle-group>

          <mat-form-field appearance="outline">
            <mat-label i18n="@@addListing.field.price.label">Sale Price</mat-label>
            <input matInput type="number" formControlName="salePrice" placeholder="100000">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label i18n="@@addListing.field.currency.label">Currency</mat-label>
            <mat-select formControlName="currency">
              <mat-option *ngFor="let c of currencies" [value]="c">{{ c }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label i18n="@@addListing.field.price.label">Rent Price</mat-label>
            <input matInput type="number" formControlName="rentPrice" placeholder="100000">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label i18n="@@addListing.field.currency.label">Currency</mat-label>
            <mat-select formControlName="currency">
              <mat-option *ngFor="let c of currencies" [value]="c">{{ c }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label i18n="@@addListing.field.category.label">Category</mat-label>
            <mat-select formControlName="category">
              <mat-option *ngFor="let cat of categories" [value]="cat">{{ cat }}</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Location -->
          <mat-form-field appearance="outline">
            <mat-label i18n="@@addListing.field.country.label">Country</mat-label>
            <input matInput formControlName="country" placeholder="Turkey">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label i18n="@@addListing.field.city.label">City</mat-label>
            <input matInput formControlName="city" placeholder="Istanbul">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label i18n="@@addListing.field.port.label">Port</mat-label>
            <input matInput formControlName="port" placeholder="Kalamis Marina">
          </mat-form-field>

          <!-- Vessel Info -->
          <h3 i18n="@@addListing.section.vessel.title">Vessel Information</h3>
          <div [formGroup]="vesselForm" class="full-width vessel-section">

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.vesselName.label">Vessel Name</mat-label>
              <input matInput formControlName="vesselName" placeholder="Sea Ray 40">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.make.label">Make</mat-label>
              <input matInput formControlName="make" placeholder="Beneteau, Sea Ray, etc.">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.model.label">Model</mat-label>
              <input matInput formControlName="model" placeholder="47 Power, Oceanis, etc.">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.year.label">Year</mat-label>
              <input matInput type="number" formControlName="year" placeholder="2022">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.boatType.label">Boat Type</mat-label>
              <mat-select formControlName="boatType">
                <mat-option *ngFor="let type of boatTypes" [value]="type">{{ type }}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.boatClass.label">Boat Class</mat-label>
              <input matInput formControlName="boatClass" placeholder="Cruiser, Motor Yacht, etc.">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.hullMaterial.label">Hull Material</mat-label>
              <mat-select formControlName="hullMaterial">
                <mat-option value="Wood">Wood</mat-option>
                <mat-option value="Fiberglass">Fiberglass</mat-option>
                <mat-option value="Aluminum">Aluminum</mat-option>
                <mat-option value="Steel">Steel</mat-option>
                <mat-option value="Composite">Composite</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.length.label">Length (m)</mat-label>
              <input matInput type="number" formControlName="length_m" placeholder="14.5">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.beam.label">Beam (m)</mat-label>
              <input matInput type="number" formControlName="beam_m" placeholder="4.5">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.draft.label">Draft (m)</mat-label>
              <input matInput type="number" formControlName="draft_m" placeholder="1.2">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.condition.label">Condition</mat-label>
              <mat-select formControlName="condition">
                <mat-option *ngFor="let c of conditions" [value]="c">{{ c }}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label i18n="@@addListing.field.capacity.label">Capacity</mat-label>
              <input matInput type="number" formControlName="capacity" placeholder="8">
            </mat-form-field>

            <!-- Engines -->
            <div formArrayName="engines" class="full-width engine-section">
              <h3 i18n="@@addListing.section.engine.title">Engines</h3>

              <div *ngFor="let engine of engines.controls; let i = index" [formGroupName]="i" class="engine-item">
                <mat-form-field appearance="outline">
                  <mat-label i18n="@@addListing.field.engine.make.label">Engine Make</mat-label>
                  <input matInput formControlName="make" placeholder="Volvo Penta">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label i18n="@@addListing.field.engine.power.label">Power (hp)</mat-label>
                  <input matInput type="number" formControlName="power_hp" placeholder="300">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label i18n="@@addListing.field.engine.hours.label">Engine Hours</mat-label>
                  <input matInput type="number" formControlName="hours" placeholder="1200">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label i18n="@@addListing.field.engine.qty.label">Qantity</mat-label>
                  <input matInput type="number" formControlName="qty" placeholder="1">
                </mat-form-field>

                <button mat-button color="warn" type="button" (click)="removeEngine(i)"
                  i18n="@@addListing.field.engine.remove">Remove</button>
              </div>

              <button mat-stroked-button color="primary" type="button" (click)="addEngine()"
                i18n="@@addListing.field.engine.add">Add Engine</button>
            </div>
          </div>

          <mat-checkbox formControlName="featured" color="primary" i18n="@@addListing.field.featured.label">
            Mark as Featured Listing
          </mat-checkbox>
          <p *ngIf="addListingForm.get('featured')?.value" class="featured-info"
            i18n="@@addListing.field.featured.info">
            Featured listings will be highlighted. A fee will be applied upon submission.
          </p>

        </div>

        <!-- Actions -->
        <div class="actions">
          <button mat-stroked-button color="warn" type="reset" i18n="@@addListing.button.reset">Reset</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading"
            i18n="@@addListing.button.submit">Create Listing</button>
        </div>

      </form>

    </mat-card-content>
  </mat-card>
</div>